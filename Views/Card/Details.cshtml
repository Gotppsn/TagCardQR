@model CardTagManager.Models.Card

@{
    ViewData["Title"] = "Card Details";
}

<div class="mb-6">
    <a asp-action="Index" class="inline-flex items-center text-primary-600 hover:text-primary-700 transition-colors group">
        <i class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i> Back to Library
    </a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 fade-in">
    <!-- Card Preview Section -->
    <div>
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-id-card text-primary-500 mr-2"></i> Card Preview
        </h2>
        
        <div class="card-container">
            <div class="business-card shadow-xl">
                <div class="card-flip-container" id="card-flip">
                    <!-- Card Front -->
                    <div class="card-side card-front" style="background-color: @Model.BackgroundColor; color: @Model.TextColor">
                        <div class="p-6 h-full flex flex-col">
                            <div class="mb-4">
                                <h3 class="text-2xl font-bold" style="color: @Model.AccentColor">@Model.Name</h3>
                                <p class="text-lg">@Model.Title</p>
                                <p class="text-xl font-bold">@Model.Company</p>
                            </div>
                            <div class="space-y-2 mt-auto">
                                <p class="flex items-center"><i class="fas fa-envelope mr-3" style="color: @Model.AccentColor"></i>@Model.Email</p>
                                <p class="flex items-center"><i class="fas fa-phone mr-3" style="color: @Model.AccentColor"></i>@Model.Phone</p>
                                @if (!string.IsNullOrEmpty(Model.Address))
                                {
                                    <p class="flex items-center"><i class="fas fa-map-marker-alt mr-3" style="color: @Model.AccentColor"></i>@Model.Address</p>
                                }
                                @if (!string.IsNullOrEmpty(Model.Website))
                                {
                                    <p class="flex items-center"><i class="fas fa-globe mr-3" style="color: @Model.AccentColor"></i>@Model.Website</p>
                                }
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card Back -->
                    <div class="card-side card-back" style="background-color: @Model.BackgroundColor; color: @Model.TextColor">
                        <div class="h-full flex items-center justify-center p-4">
                            <div class="text-center">
                                <div class="mb-4">
                                    <img src="@ViewBag.QrCodeImage" alt="QR Code" class="mx-auto h-40 w-40 rounded-lg shadow-md" />
                                </div>
                                <p class="text-sm font-medium" style="color: @Model.AccentColor">Scan to Save Contact</p>
                                <p class="text-xs mt-2 text-gray-600">@Model.Company</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 flex justify-center">
                <button id="flip-card-btn" class="btn-secondary">
                    <i class="fas fa-sync-alt"></i> <span id="flip-text">Show QR Code</span>
                </button>
            </div>
        </div>
        
        <div class="mt-6 flex flex-wrap gap-3 justify-center">
            <a asp-action="Print" asp-route-id="@Model.Id" class="btn-primary">
                <i class="fas fa-print"></i> Print Card
            </a>
            <a asp-action="Edit" asp-route-id="@Model.Id" class="btn-secondary">
                <i class="fas fa-edit"></i> Edit Card
            </a>
            <a asp-action="Vcf" asp-route-id="@Model.Id" class="btn-secondary">
                <i class="fas fa-address-card"></i> Download vCard
            </a>
        </div>
    </div>
    
    <!-- Card Details Section -->
    <div>
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-info-circle text-primary-500 mr-2"></i> Card Details
        </h2>
        
        <div class="card">
            <div class="card-body">
                <h3 class="font-semibold text-gray-700 mb-2">Contact Information</h3>
                <div class="space-y-4 mb-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center">
                            <i class="fas fa-user text-primary-600"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">@Model.Name</p>
                            <p class="text-sm text-gray-500">@Model.Title</p>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center">
                            <i class="fas fa-building text-primary-600"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">@Model.Company</p>
                            @if (!string.IsNullOrEmpty(Model.Address))
                            {
                                <p class="text-sm text-gray-500">@Model.Address</p>
                            }
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center">
                            <i class="fas fa-envelope text-primary-600"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">@Model.Email</p>
                            <button onclick="copyToClipboard('@Model.Email')" class="text-sm text-primary-600 hover:text-primary-700">
                                <i class="fas fa-copy mr-1"></i> Copy
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center">
                            <i class="fas fa-phone text-primary-600"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">@Model.Phone</p>
                            <button onclick="copyToClipboard('@Model.Phone')" class="text-sm text-primary-600 hover:text-primary-700">
                                <i class="fas fa-copy mr-1"></i> Copy
                            </button>
                        </div>
                    </div>
                    
                    @if (!string.IsNullOrEmpty(Model.Website))
                    {
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center">
                                <i class="fas fa-globe text-primary-600"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-gray-900">@Model.Website</p>
                                <a href="@Model.Website" target="_blank" class="text-sm text-primary-600 hover:text-primary-700">
                                    <i class="fas fa-external-link-alt mr-1"></i> Visit
                                </a>
                            </div>
                        </div>
                    }
                </div>
                
                <h3 class="font-semibold text-gray-700 mb-2">Card Design</h3>
                <div class="grid grid-cols-3 gap-3 mb-6">
                    <div class="bg-white rounded-lg border p-3 text-center">
                        <div class="w-full h-12 rounded mb-2 shadow-inner" style="background-color: @Model.BackgroundColor"></div>
                        <p class="text-xs font-medium">Background</p>
                        <p class="text-xs font-mono text-gray-500">@Model.BackgroundColor</p>
                    </div>
                    
                    <div class="bg-white rounded-lg border p-3 text-center">
                        <div class="w-full h-12 rounded mb-2 shadow-inner" style="background-color: @Model.TextColor"></div>
                        <p class="text-xs font-medium">Text</p>
                        <p class="text-xs font-mono text-gray-500">@Model.TextColor</p>
                    </div>
                    
                    <div class="bg-white rounded-lg border p-3 text-center">
                        <div class="w-full h-12 rounded mb-2 shadow-inner" style="background-color: @Model.AccentColor"></div>
                        <p class="text-xs font-medium">Accent</p>
                        <p class="text-xs font-mono text-gray-500">@Model.AccentColor</p>
                    </div>
                </div>
                
                <h3 class="font-semibold text-gray-700 mb-2">Card Information</h3>
                <div class="space-y-2 text-sm mb-4">
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-500">Created On</span>
                        <span class="font-medium">@Model.CreatedAt.ToString("MMM d, yyyy 'at' h:mm tt")</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-500">Last Updated</span>
                        <span class="font-medium">@Model.UpdatedAt.ToString("MMM d, yyyy 'at' h:mm tt")</span>
                    </div>
                    <div class="flex justify-between py-2 border-b border-gray-100">
                        <span class="text-gray-500">Card ID</span>
                        <span class="font-medium">#@Model.Id</span>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row sm:justify-end gap-3 mt-6">
                    <button onclick="showQrCode()" class="btn-secondary">
                        <i class="fas fa-qrcode"></i> View QR Code
                    </button>
                    <button onclick="copyContactInfo()" class="btn-secondary">
                        <i class="fas fa-copy"></i> Copy All Info
                    </button>
                    <a asp-action="Delete" asp-route-id="@Model.Id" class="btn-danger">
                        <i class="fas fa-trash-alt"></i> Delete Card
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- QR Code Modal -->
<div id="qr-modal" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden fade-in">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-bold text-gray-900">QR Code</h3>
            <button onclick="hideQrCode()" class="text-gray-400 hover:text-gray-500">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="text-center">
            <img src="@ViewBag.QrCodeImage" alt="QR Code" class="h-64 w-64 mx-auto rounded-lg shadow-md" />
            <p class="mt-4 text-sm text-gray-500">Scan this QR code to add @Model.Name to your contacts</p>
        </div>
        <div class="mt-6 flex justify-center">
            <a asp-action="QrCode" asp-route-id="@Model.Id" target="_blank" class="btn-primary">
                <i class="fas fa-external-link-alt"></i> Open in New Window
            </a>
        </div>
    </div>
</div>

@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Card flip functionality
        const flipBtn = document.getElementById('flip-card-btn');
        const cardFlip = document.getElementById('card-flip');
        const flipText = document.getElementById('flip-text');
        
        flipBtn.addEventListener('click', function() {
            cardFlip.classList.toggle('flipped');
            if (cardFlip.classList.contains('flipped')) {
                flipText.textContent = 'Show Front';
            } else {
                flipText.textContent = 'Show QR Code';
            }
        });
    });
    
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showNotification('Copied to clipboard');
        }, () => {
            showNotification('Failed to copy', 'error');
        });
    }
    
    function copyContactInfo() {
        const contactInfo = `Name: @Model.Name
Title: @Model.Title
Company: @Model.Company
Email: @Model.Email
Phone: @Model.Phone
@if (!string.IsNullOrEmpty(Model.Address))
{
@:Address: @Model.Address
}
@if (!string.IsNullOrEmpty(Model.Website))
{
@:Website: @Model.Website
}`;

        navigator.clipboard.writeText(contactInfo).then(() => {
            showNotification('Contact information copied to clipboard');
        }, () => {
            showNotification('Failed to copy contact information', 'error');
        });
    }
    
    function showQrCode() {
        const modal = document.getElementById('qr-modal');
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function hideQrCode() {
        const modal = document.getElementById('qr-modal');
        modal.classList.add('hidden');
        document.body.style.overflow = '';
    }
    
    // Close modal when clicking outside
    document.getElementById('qr-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            hideQrCode();
        }
    });
</script>
}