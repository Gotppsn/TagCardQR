@model CardTagManager.Models.Card

@{
    ViewData["Title"] = "Create New Card";
}

<div class="mb-6">
    <a asp-action="Index" class="inline-flex items-center text-primary-600 hover:text-primary-700 transition-colors group">
        <i class="fas fa-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i> Back to Library
    </a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-5 gap-8 fade-in">
    <!-- Form Section (3 columns) -->
    <div class="lg:col-span-3">
        <div class="card">
            <div class="card-header">
                <h2 class="text-xl font-bold text-gray-800 flex items-center">
                    <i class="fas fa-plus-circle text-primary-500 mr-2"></i> Create New Card
                </h2>
                <p class="text-sm text-gray-500 mt-1">Fill in the details for your new business card</p>
            </div>
            
            <form asp-action="Create" method="post" id="card-form">
                <div class="card-body">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="form-group">
                                <label asp-for="Name" class="form-label">Full Name</label>
                                <input asp-for="Name" class="form-input" required placeholder="John Doe" />
                                <span asp-validation-for="Name" class="form-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label asp-for="Title" class="form-label">Job Title</label>
                                <input asp-for="Title" class="form-input" required placeholder="Senior Developer" />
                                <span asp-validation-for="Title" class="form-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label asp-for="Company" class="form-label">Company</label>
                                <input asp-for="Company" class="form-input" required placeholder="Tech Solutions Inc." />
                                <span asp-validation-for="Company" class="form-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label asp-for="Email" class="form-label">Email Address</label>
                                <input asp-for="Email" type="email" class="form-input" required placeholder="john.doe@example.com" />
                                <span asp-validation-for="Email" class="form-error"></span>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="form-group">
                                <label asp-for="Phone" class="form-label">Phone Number</label>
                                <input asp-for="Phone" class="form-input" required placeholder="+1 (555) 123-4567" />
                                <span asp-validation-for="Phone" class="form-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label asp-for="Address" class="form-label">Address <span class="text-xs text-gray-500">(Optional)</span></label>
                                <input asp-for="Address" class="form-input" placeholder="123 Business St, City, State 12345" />
                                <span asp-validation-for="Address" class="form-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label asp-for="Website" class="form-label">Website <span class="text-xs text-gray-500">(Optional)</span></label>
                                <input asp-for="Website" type="url" class="form-input" placeholder="https://example.com" />
                                <span asp-validation-for="Website" class="form-error"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-100">
                        <h3 class="font-medium text-gray-800 mb-3">Card Appearance</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label asp-for="BackgroundColor" class="form-label">Background Color</label>
                                <div class="flex">
                                    <input asp-for="BackgroundColor" type="color" class="h-10 w-12 border border-gray-300 rounded-l cursor-pointer" />
                                    <input asp-for="BackgroundColor" type="text" class="form-input rounded-l-none flex-grow" />
                                </div>
                                <span asp-validation-for="BackgroundColor" class="form-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label asp-for="TextColor" class="form-label">Text Color</label>
                                <div class="flex">
                                    <input asp-for="TextColor" type="color" class="h-10 w-12 border border-gray-300 rounded-l cursor-pointer" />
                                    <input asp-for="TextColor" type="text" class="form-input rounded-l-none flex-grow" />
                                </div>
                                <span asp-validation-for="TextColor" class="form-error"></span>
                            </div>
                            
                            <div class="form-group">
                                <label asp-for="AccentColor" class="form-label">Accent Color</label>
                                <div class="flex">
                                    <input asp-for="AccentColor" type="color" class="h-10 w-12 border border-gray-300 rounded-l cursor-pointer" />
                                    <input asp-for="AccentColor" type="text" class="form-input rounded-l-none flex-grow" />
                                </div>
                                <span asp-validation-for="AccentColor" class="form-error"></span>
                            </div>
                        </div>
                        
                        <div class="mt-3 flex flex-wrap gap-2">
                            <p class="text-sm text-gray-500 w-full mb-1">Quick Colors:</p>
                            <button type="button" class="color-preset w-8 h-8 rounded-full shadow-sm border border-gray-200" 
                                    style="background-color: #ffffff; color: #000000; border: 2px solid #0284c7"
                                    data-bg="#ffffff" data-text="#000000" data-accent="#0284c7"></button>
                            <button type="button" class="color-preset w-8 h-8 rounded-full shadow-sm border border-gray-200" 
                                    style="background-color: #1e293b; color: #ffffff; border: 2px solid #38bdf8"
                                    data-bg="#1e293b" data-text="#ffffff" data-accent="#38bdf8"></button>
                            <button type="button" class="color-preset w-8 h-8 rounded-full shadow-sm border border-gray-200" 
                                    style="background-color: #f8fafc; color: #1e293b; border: 2px solid #f97316"
                                    data-bg="#f8fafc" data-text="#1e293b" data-accent="#f97316"></button>
                            <button type="button" class="color-preset w-8 h-8 rounded-full shadow-sm border border-gray-200" 
                                    style="background-color: #f0fdf4; color: #166534; border: 2px solid #16a34a"
                                    data-bg="#f0fdf4" data-text="#166534" data-accent="#16a34a"></button>
                            <button type="button" class="color-preset w-8 h-8 rounded-full shadow-sm border border-gray-200" 
                                    style="background-color: #eff6ff; color: #1e40af; border: 2px solid #3b82f6"
                                    data-bg="#eff6ff" data-text="#1e40af" data-accent="#3b82f6"></button>
                        </div>
                    </div>
                </div>
                
                <div class="card-footer flex justify-end">
                    <a asp-action="Index" class="btn-secondary mr-3">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Create Card
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Preview Section (2 columns) -->
    <div class="lg:col-span-2">
        <div class="sticky top-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-eye text-primary-500 mr-2"></i> Card Preview
            </h3>
            
            <div class="business-card" id="card-preview" style="background-color: #ffffff; color: #000000">
                <div class="p-6 h-full flex flex-col">
                    <div class="mb-4">
                        <h3 id="preview-name" class="text-2xl font-bold" style="color: #0284c7">Your Name</h3>
                        <p id="preview-title" class="text-lg">Your Title</p>
                        <p id="preview-company" class="text-xl font-bold">Your Company</p>
                    </div>
                    <div class="space-y-2 mt-auto">
                        <p class="flex items-center"><i class="fas fa-envelope mr-3" style="color: #0284c7"></i><span id="preview-email">your.email@example.com</span></p>
                        <p class="flex items-center"><i class="fas fa-phone mr-3" style="color: #0284c7"></i><span id="preview-phone">+1 (555) 123-4567</span></p>
                        <p class="flex items-center"><i class="fas fa-map-marker-alt mr-3" style="color: #0284c7"></i><span id="preview-address">Your Address</span></p>
                        <p class="flex items-center"><i class="fas fa-globe mr-3" style="color: #0284c7"></i><span id="preview-website">www.example.com</span></p>
                    </div>
                </div>
            </div>
            
            <div class="mt-3 text-center">
                <button type="button" id="update-preview" class="btn-secondary btn-sm w-full">
                    <i class="fas fa-sync-alt"></i> Update Preview
                </button>
                <p class="text-xs text-gray-500 mt-2">Preview updates automatically as you type</p>
            </div>
            
            <div class="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-info-circle text-blue-400"></i>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-medium text-blue-800">Tips for great business cards</h3>
                        <ul class="mt-2 text-sm text-blue-700 list-disc list-inside">
                            <li>Keep text concise and readable</li>
                            <li>Use contrasting colors for better legibility</li>
                            <li>Include only essential contact information</li>
                            <li>Choose colors that reflect your brand</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input');
            const colorInputs = document.querySelectorAll('input[type="color"]');
            const previewButton = document.getElementById('update-preview');
            const presetButtons = document.querySelectorAll('.color-preset');
            
            // Initialize preview
            updateCardPreview();
            
            // Update preview on form input
            inputs.forEach(input => {
                input.addEventListener('input', updateCardPreview);
            });
            
            // Update text field when color picker changes
            colorInputs.forEach(input => {
                input.addEventListener('change', function() {
                    const textInput = this.nextElementSibling;
                    if (textInput) {
                        textInput.value = this.value;
                    }
                    updateCardPreview();
                });
            });
            
            // Handle color presets
            presetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const bg = this.getAttribute('data-bg');
                    const text = this.getAttribute('data-text');
                    const accent = this.getAttribute('data-accent');
                    
                    // Update form inputs
                    document.getElementById('BackgroundColor').value = bg;
                    document.querySelector('input[type="text"][id="BackgroundColor"]').value = bg;
                    
                    document.getElementById('TextColor').value = text;
                    document.querySelector('input[type="text"][id="TextColor"]').value = text;
                    
                    document.getElementById('AccentColor').value = accent;
                    document.querySelector('input[type="text"][id="AccentColor"]').value = accent;
                    
                    updateCardPreview();
                    
                    // Add highlight effect
                    this.classList.add('ring-4', 'ring-primary-200');
                    setTimeout(() => {
                        this.classList.remove('ring-4', 'ring-primary-200');
                    }, 500);
                });
            });
            
            // Force update preview button
            previewButton.addEventListener('click', function() {
                updateCardPreview();
                const preview = document.getElementById('card-preview');
                preview.classList.add('update-animation');
                setTimeout(() => {
                    preview.classList.remove('update-animation');
                }, 1000);
            });
            
            // Function to update card preview
            function updateCardPreview() {
                const name = document.getElementById('Name')?.value || 'Your Name';
                const title = document.getElementById('Title')?.value || 'Your Title';
                const company = document.getElementById('Company')?.value || 'Your Company';
                const email = document.getElementById('Email')?.value || 'your.email@example.com';
                const phone = document.getElementById('Phone')?.value || '+1 (555) 123-4567';
                const address = document.getElementById('Address')?.value || 'Your Address';
                const website = document.getElementById('Website')?.value || 'www.example.com';
                
                const bgColor = document.getElementById('BackgroundColor')?.value || '#ffffff';
                const textColor = document.getElementById('TextColor')?.value || '#000000';
                const accentColor = document.getElementById('AccentColor')?.value || '#0284c7';
                
                const preview = document.getElementById('card-preview');
                
                // Update text content
                document.getElementById('preview-name').textContent = name;
                document.getElementById('preview-title').textContent = title;
                document.getElementById('preview-company').textContent = company;
                document.getElementById('preview-email').textContent = email;
                document.getElementById('preview-phone').textContent = phone;
                document.getElementById('preview-address').textContent = address || 'Your Address';
                document.getElementById('preview-website').textContent = website || 'www.example.com';
                
                // Update styles
                preview.style.backgroundColor = bgColor;
                preview.style.color = textColor;
                document.getElementById('preview-name').style.color = accentColor;
                
                const icons = preview.querySelectorAll('i');
                icons.forEach(icon => {
                    icon.style.color = accentColor;
                });
            }
            
            // Form validation
            const form = document.getElementById('card-form');
            form.addEventListener('submit', function(e) {
                const requiredFields = form.querySelectorAll('[required]');
                let hasErrors = false;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        hasErrors = true;
                        field.classList.add('border-red-500');
                        if (!field.nextElementSibling.textContent) {
                            field.nextElementSibling.textContent = 'This field is required';
                        }
                    } else {
                        field.classList.remove('border-red-500');
                        if (field.nextElementSibling.textContent === 'This field is required') {
                            field.nextElementSibling.textContent = '';
                        }
                    }
                });
                
                if (hasErrors) {
                    e.preventDefault();
                    const firstError = form.querySelector('.border-red-500');
                    if (firstError) {
                        firstError.focus();
                        showNotification('Please fill in all required fields', 'error');
                    }
                }
            });
        });
    </script>
}