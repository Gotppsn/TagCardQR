@model IEnumerable<CardTagManager.Models.Card>

@{
    ViewData["Title"] = "Card Library";
}

<div class="mb-4">
    <h2 class="text-xl font-semibold text-blue-600 mb-4">Card Library</h2>
    
    <div class="flex justify-between items-center mb-4">
        <div class="relative">
            <input type="text" id="card-search" placeholder="Search cards..." 
                   class="px-3 py-2 border border-gray-300 rounded" />
            <button class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400">
                <i class="fas fa-search"></i>
            </button>
        </div>
        
        <a asp-action="Create" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded flex items-center">
            <i class="fas fa-plus mr-1"></i> New Card
        </a>
    </div>
    
    <div class="mb-4">
        <div class="inline-flex border border-gray-300 rounded">
            <button id="all-cards-btn" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-l border-r border-gray-300">
                <i class="fas fa-list-ul mr-1"></i> All Cards
            </button>
            <button id="recently-updated-btn" class="px-3 py-1 text-gray-700 rounded-r">
                <i class="fas fa-clock mr-1"></i> Recently Updated
            </button>
        </div>
    </div>
</div>

@if (!Model.Any())
{
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fas fa-exclamation-triangle text-yellow-400"></i>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    No cards found. Get started by creating a new card.
                </p>
            </div>
        </div>
    </div>
}
else
{
    <div id="cards-container" class="space-y-4">
        @foreach (var card in Model)
        {
            <div class="card-item border border-gray-200 rounded overflow-hidden bg-white" 
                 data-updated="@card.UpdatedAt.ToString("yyyy-MM-dd")">
                <div class="p-4">
                    <h3 class="text-lg font-medium text-blue-600">@card.Name</h3>
                    <p class="text-sm text-gray-600">@card.Title</p>
                    <p class="font-medium mb-3">@card.Company</p>
                    
                    <div class="space-y-1 text-sm">
                        <p><i class="fas fa-envelope mr-2 text-blue-500"></i>@card.Email</p>
                        <p><i class="fas fa-phone mr-2 text-blue-500"></i>@card.Phone</p>
                        @if (!string.IsNullOrEmpty(card.Address))
                        {
                            <p><i class="fas fa-map-marker-alt mr-2 text-blue-500"></i>@card.Address</p>
                        }
                        @if (!string.IsNullOrEmpty(card.Website))
                        {
                            <p><i class="fas fa-globe mr-2 text-blue-500"></i>@card.Website</p>
                        }
                    </div>
                </div>
                
                <div class="bg-gray-50 px-4 py-2 flex justify-end space-x-3">
                    <a asp-action="Details" asp-route-id="@card.Id" class="text-blue-600 hover:text-blue-800">
                        <i class="fas fa-eye"></i> View
                    </a>
                    <a asp-action="Edit" asp-route-id="@card.Id" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-edit"></i>
                    </a>
                    <a asp-action="Print" asp-route-id="@card.Id" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-print"></i>
                    </a>
                    <a asp-action="Delete" asp-route-id="@card.Id" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </a>
                </div>
            </div>
        }
    </div>
}

@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Card search functionality
        const searchInput = document.getElementById('card-search');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const cards = document.querySelectorAll('.card-item');
                
                cards.forEach(card => {
                    const cardText = card.textContent.toLowerCase();
                    if (cardText.includes(searchTerm)) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }
        
        // Filter buttons
        const allCardsBtn = document.getElementById('all-cards-btn');
        const recentlyUpdatedBtn = document.getElementById('recently-updated-btn');
        
        if (allCardsBtn && recentlyUpdatedBtn) {
            allCardsBtn.addEventListener('click', function() {
                this.classList.add('bg-gray-100');
                recentlyUpdatedBtn.classList.remove('bg-gray-100');
                
                const cards = document.querySelectorAll('.card-item');
                cards.forEach(card => {
                    card.style.display = '';
                });
            });
            
            recentlyUpdatedBtn.addEventListener('click', function() {
                this.classList.add('bg-gray-100');
                allCardsBtn.classList.remove('bg-gray-100');
                
                const cards = document.querySelectorAll('.card-item');
                const today = new Date();
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(today.getDate() - 7);
                
                cards.forEach(card => {
                    const updatedDate = new Date(card.getAttribute('data-updated'));
                    
                    if (updatedDate >= oneWeekAgo) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        }
    });
</script>
}